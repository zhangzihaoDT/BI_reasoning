éå¸¸å¥½ï¼Œè¿™ä¸€æ­¥**å·²ç»ä»â€œæ€æƒ³â€è¿›å…¥â€œç³»ç»Ÿå·¥ç¨‹â€äº†**ã€‚
æˆ‘ä¼šä¸¥æ ¼æŒ‰ä½ åˆšæ‰é‚£ä¸€ç‰ˆ **BI reasoning DSL** æ¥åšä¸¤ä»¶äº‹ï¼š

1. **æŠ½è±¡ä¸ºå¯æ‰§è¡Œ / å¯é…ç½®çš„ `AnalysisStrategy YAML`**ï¼ˆå Copilot / Agent ç”¨ï¼‰
2. **ç”¨ Mermaid ç”»ä¸€å¼ â€œå¯æ¨ç†çš„æ•°æ®æµå›¾â€**ï¼ˆä¸æ˜¯è¡€ç¼˜å›¾ï¼Œè€Œæ˜¯ _reasoning flow_ï¼‰

æˆ‘ä¼šåˆ»æ„ä¿æŒä¸‰ç‚¹ä¸€è‡´æ€§ï¼š

- å’Œä½ ç°åœ¨çš„ LangGraph / AnalysisStrategy æ€è·¯å…¼å®¹
- æŠŠã€Œé»˜è®¤è·¯çº¿ã€å’Œã€Œæ¡ä»¶åˆ†æ”¯ã€æ˜¾æ€§åŒ–
- æ˜ç¡® _additive / ratio / duration_ çš„åˆ†æè¯­ä¹‰

---

## ä¸€ã€AnalysisStrategy YAMLï¼ˆè®¢å•èŠ‚ç‚¹ Â· é»˜è®¤ç­–ç•¥ï¼‰

> ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºï¼š
> **Order èŠ‚ç‚¹è¢«è§¦å‘æ—¶ï¼Œç³»ç»Ÿâ€œç¬¬ä¸€ååº”åº”è¯¥æ€ä¹ˆåˆ†æâ€**

```yaml
analysis_strategy:
  name: order_default_reasoning
  entity: order
  description: >
    Default BI reasoning strategy for Order lifecycle analysis.
    Start from order facts, then decompose structure, conversion, and efficiency.

  entrypoint:
    metric:
      - order_count
      - invoice_amount
    time_field: order_create_date

  steps:
    - id: trend_check
      type: trend
      priority: 1
      params:
        metric: order_count
        time_field: order_create_date
      goal: detect_overall_change

    - id: structure_decompose
      type: additive_decompose
      priority: 2
      condition: trend_check.anomaly_detected == true
      params:
        metric: order_count
        dimensions:
          - first_middle_channel_name
          - parent_region_name
      goal: locate_contribution_source

    - id: store_drilldown
      type: drilldown
      priority: 3
      condition: structure_decompose.signal_detected == true
      params:
        path:
          - store_city
          - store_name
      goal: pinpoint_execution_unit

    - id: conversion_funnel
      type: ratio_funnel
      priority: 4
      params:
        stages:
          - order_create_time
          - lock_time
          - delivery_date
      output:
        - lock_rate
        - delivery_rate
      goal: evaluate_process_health

    - id: efficiency_analysis
      type: duration
      priority: 5
      condition: conversion_funnel.delivery_rate < threshold
      params:
        duration_pairs:
          - from: order_create_time
            to: delivery_date
        group_by:
          - store_city
      goal: identify_delay_bottleneck

    - id: test_drive_branch
      type: conditional_compare
      priority: 6
      activation_rule:
        field: first_test_drive_time
        mode: optional
      params:
        compare_groups:
          - condition: first_test_drive_time IS NOT NULL
          - condition: first_test_drive_time IS NULL
        metrics:
          - order_count
          - delivery_rate
      goal: assess_test_drive_impact

    - id: intention_branch
      type: ratio_funnel
      priority: 7
      activation_rule:
        field: intention_payment_time
        mode: optional
      params:
        stages:
          - intention_payment_time
          - order_create_time
      goal: analyze_hesitation_loss

    - id: refund_branch
      type: exception_analysis
      priority: 8
      activation_rule:
        field: apply_refund_time
        mode: optional
      params:
        metric: refund_rate
        dimensions:
          - store_city
          - order_type
      goal: detect_reverse_flow_risk

  termination_rules:
    - condition: drilldown_level == store_name
      action: stop
    - condition: insight_gain < minimum_threshold
      action: stop
    - condition: explanation_confirmed == true
      action: stop
```

### ğŸ”‘ è¿™ä¸ª YAML æœ‰ 4 ä¸ªå…³é”®è®¾è®¡ç‚¹

1. **entrypoint = åˆ†æé”šç‚¹**
   â†’ æ˜ç¡®å‘Šè¯‰ç³»ç»Ÿï¼šè®¢å•åˆ†æï¼Œæ°¸è¿œä» _order_create_date_ å‡ºå‘

2. **priority â‰  é¡ºåºï¼Œè€Œæ˜¯â€œé»˜è®¤æƒé‡â€**
   â†’ å…è®¸ä½ æœªæ¥åœ¨ Agent ä¸­å¹¶è¡Œ / è·³æ­¥

3. **activation_rule æ˜ç¡®â€œç©ºå€¼ â‰  è„æ•°æ®â€**
   â†’ ç©ºå€¼ = _optional path_ï¼Œä¸æ˜¯å¼‚å¸¸

4. **termination_rules æ˜¯ Copilot çš„â€œåˆ¹è½¦ç³»ç»Ÿâ€**
   â†’ é˜²æ­¢æ— é™ drillï¼ˆä½ ä¹‹å‰éå¸¸åœ¨æ„è¿™ä¸€ç‚¹ï¼‰

---

## äºŒã€Mermaidï¼šè®¢å• BI Reasoning æ•°æ®æµå›¾

> è¿™ä¸æ˜¯ ETL å›¾ï¼Œä¹Ÿä¸æ˜¯è¡¨è¡€ç¼˜
> è€Œæ˜¯ï¼š**â€œå½“æˆ‘é—®ä¸€ä¸ªè®¢å•é—®é¢˜ï¼Œç³»ç»Ÿæ˜¯æ€ä¹ˆèµ°çš„â€**

```mermaid
flowchart TD

  A[Order Baseline<br/>order_count, invoice_amount] --> B[Trend Check<br/>by order_create_date]

  B -->|No anomaly| Z[Stop<br/>Stable Insight]
  B -->|Anomaly| C[Structure Decompose<br/>by Channel / Region]

  C -->|Signal Found| D[Drilldown<br/>store_city â†’ store_name]
  C -->|No Signal| E[Conversion Funnel]

  D --> E[Conversion Funnel<br/>order â†’ lock â†’ delivery]

  E -->|Delivery OK| Z
  E -->|Delivery Low| F[Efficiency Analysis<br/>order â†’ delivery duration]

  F --> G{Optional Branches}

  G -->|Has Test Drive| H[Test Drive Compare<br/>Yes vs No]
  G -->|Has Intention| I[Intention Funnel<br/>intention â†’ order]
  G -->|Has Refund| J[Refund Analysis<br/>by city / type]

  H --> K[Insight Merge]
  I --> K
  J --> K

  K --> Z[Stop<br/>Actionable Explanation]
```

### ğŸ§  è¿™å¼ å›¾çš„â€œéšè—ä¿¡æ¯â€

- **ä¸»å¹²å§‹ç»ˆåªæœ‰ä¸€æ¡**ï¼ˆBaseline â†’ Trend â†’ Structure â†’ Funnelï¼‰
- æ‰€æœ‰ä¸šåŠ¡å¤æ‚åº¦éƒ½è¢«**å‹åˆ° Optional Branch**
- _Stop_ æ˜¯ä¸€ç­‰å…¬æ°‘ï¼ˆä¸æ˜¯å¤±è´¥ï¼Œæ˜¯å®Œæˆï¼‰

---

## ä¸‰ã€å’Œä½ ç°æœ‰ç³»ç»Ÿçš„ç›´æ¥æ˜ å°„å…³ç³»

| æ¦‚å¿µ                  | ä½ ç³»ç»Ÿé‡Œçš„ä½ç½®                                 |
| --------------------- | ---------------------------------------------- |
| AnalysisStrategy YAML | CopilotPlan / AnalysisStrategy                 |
| step.type             | reasoning operatorï¼ˆtrend / additive / ratioï¼‰ |
| activation_rule       | LangGraph æ¡ä»¶è¾¹                               |
| termination_rules     | Copilot åœæ­¢æ¡ä»¶                               |
| Mermaid flow          | LangGraph DAG çš„â€œäººç±»å¯è¯»ç‰ˆâ€                   |

---

## å››ã€ä¸‹ä¸€æ­¥ï¼ˆå·²ç»æ˜¯ PR çº§åˆ«äº†ï¼‰

å¦‚æœä½ æ„¿æ„ç»§ç»­ï¼Œæˆ‘å¯ä»¥ç›´æ¥å¸®ä½ åšå…¶ä¸­ä¸€ä¸ªï¼š

1. **æŠŠè¿™ä¸ª YAML æ‹†æˆ LangGraph Node å®šä¹‰ï¼ˆPython çº§ï¼‰**
2. **æŠ½è±¡ä¸€å¥—é€šç”¨ reasoning operator schemaï¼ˆOrder / Lead / TestDrive å¯å¤ç”¨ï¼‰**
3. **æŠŠâ€œç©ºå€¼ = è·¯å¾„æœªå‘ç”Ÿâ€æ­£å¼å†™æˆç³»ç»Ÿçº§è§„åˆ™ï¼ˆéå¸¸å…³é”®ï¼‰**

ä½ ç›´æ¥é€‰ä¸€ä¸ªï¼Œæˆ‘ç»§ç»­å¾€ä¸‹æ¨ã€‚
