è¿™æ˜¯ä¸€ä¸ªåŸºäº LLM çš„ **æ™ºèƒ½ BI åˆ†æè§„åˆ’ç³»ç»Ÿ (BI Planning Agent)**ã€‚è¯¥é¡¹ç›®çš„æ ¸å¿ƒç›®æ ‡æ˜¯å°†ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€ä¸šåŠ¡é—®é¢˜ï¼ˆå¦‚â€œæ˜¨æ—¥é”€é‡å¦‚ä½•â€ï¼‰è½¬åŒ–ä¸ºç»“æ„åŒ–ã€å¯æ‰§è¡Œçš„åˆ†æåŠ¨ä½œåºåˆ—ï¼ˆDSLï¼‰ï¼Œæ¨¡æ‹Ÿé«˜çº§æ•°æ®åˆ†æå¸ˆçš„æ€ç»´è·¯å¾„ã€‚

ä»¥ä¸‹æ˜¯ä¸ºæ‚¨æ•´ç†çš„é¡¹ç›®ç»éªŒæ–‡æ¡£æ€»ç»“ã€‚

---

# W52 Copilot é¡¹ç›®ç»éªŒæ–‡æ¡£

## 1. é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ„å»ºäº†ä¸€ä¸ª **é…ç½®é©±åŠ¨çš„æ™ºèƒ½è§„åˆ’ Agent** (`PlanningAgent`)ã€‚å®ƒä¸ç›´æ¥æ‰§è¡Œ SQLï¼Œè€Œæ˜¯å……å½“â€œåˆ†æå¤§è„‘â€ï¼Œè´Ÿè´£ç†è§£ä¸šåŠ¡æ„å›¾å¹¶ç”Ÿæˆæ ‡å‡†åŒ–çš„ **è¯„ä¼°åŠ¨ä½œçŸ©é˜µ (Evaluation Action Matrix)**ã€‚

æ ¸å¿ƒè®¾è®¡ç†å¿µæ˜¯å°† **ä¸šåŠ¡é€»è¾‘ï¼ˆRules/Definitionsï¼‰** ä¸ **ä»£ç é€»è¾‘ï¼ˆAgent Codeï¼‰** åˆ†ç¦»ï¼Œé€šè¿‡ YAML å’Œ JSON é…ç½®æ–‡ä»¶æ¥å®šä¹‰åˆ†æç­–ç•¥ã€æŒ‡æ ‡å£å¾„å’Œäº§å“è§„åˆ™ï¼Œä½¿å¾—ç³»ç»Ÿå…·å¤‡æé«˜çš„æ‰©å±•æ€§å’Œç»´æŠ¤æ€§ã€‚

## 2. é¡¹ç›®ç»“æ„è¯´æ˜

```text
W52_copilot/
â”œâ”€â”€ agents/                      # æ™ºèƒ½ä½“æ ¸å¿ƒé€»è¾‘å±‚
â”‚   â”œâ”€â”€ planning_agent.py        # [æ ¸å¿ƒ] è§„åˆ’æ™ºèƒ½ä½“ä¸»ç¨‹åºã€‚è´Ÿè´£åŠ è½½ä¸Šä¸‹æ–‡ã€è°ƒç”¨ LLMã€ç”Ÿæˆ DSLã€‚
â”‚   â”œâ”€â”€ query_agent.py           # [æ ¸å¿ƒ] åŸºäºå¯å‘å¼ä¸è§„åˆ™çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢ Agentã€‚
â”‚   â”œâ”€â”€ query_skills.yaml        # [æ ¸å¿ƒ] æŸ¥è¯¢æŠ€èƒ½é…ç½®æ–‡ä»¶ã€‚å®šä¹‰æŒ‡æ ‡åˆ«åã€ç»´åº¦æ˜ å°„ä¸å·¥å…·é€‰æ‹©è§„åˆ™ã€‚
â”‚   â”œâ”€â”€ planning_skills.yaml     # [æ ¸å¿ƒ] è§„åˆ’æŠ€èƒ½é…ç½®ã€‚æ›¿ä»£æ—§ç‰ˆ rulesï¼Œå®šä¹‰æ„å›¾åˆ†ç±»ä¸åˆ†æç­–ç•¥ã€‚
â”‚   â”œâ”€â”€ suggestion_agent.py      # [æ–°å¢] å»ºè®®ç”Ÿæˆ Agentã€‚åŸºäº Schema æä¾›åˆ†æå»ºè®®ã€‚
â”‚   â””â”€â”€ planning_agentæ”¹è¿›å»ºè®®.md  # ä¼˜åŒ–è®°å½•æ–‡æ¡£ã€‚
â”œâ”€â”€ pipelines/                   # [æ–°å¢] ç«¯åˆ°ç«¯æ‰§è¡Œç®¡é“
â”‚   â”œâ”€â”€ simple_query.py          # äº¤äº’å¼æŸ¥è¯¢ç®¡é“ï¼Œæ”¯æŒå‘½ä»¤è¡Œå‚æ•°ä¸ REPL æ¨¡å¼ã€‚
â”‚   â”œâ”€â”€ yesterday_lock_reasoner.py # åŸºäº Reasoner çš„æ—¥æŠ¥ç”Ÿæˆç®¡é“
â”‚   â””â”€â”€ ...
â”œâ”€â”€ runtime/                     # [æ–°å¢] è¿è¡Œæ—¶ç¯å¢ƒ
â”‚   â”œâ”€â”€ context.py               # æ•°æ®ä¸Šä¸‹æ–‡ç®¡ç†å™¨ (DataManager) - æ”¯æŒå¤šæ—¶é—´è½´ (Create/Lock/Delivery)
â”‚   â””â”€â”€ signals.py               # ä¿¡å·ä¸å¼‚å¸¸æ£€æµ‹é€»è¾‘
â”œâ”€â”€ world/                       # é¢†åŸŸçŸ¥è¯†å±‚ (World Model)
â”‚   â”œâ”€â”€ schema.md                # æ•°æ®æ¨¡å¼å®šä¹‰ã€‚åŒ…å«ç»´åº¦ã€æŒ‡æ ‡ã€æ—¶é—´å­—æ®µåŠè®¡ç®—å£å¾„ã€‚
â”‚   â”œâ”€â”€ tool.md                  # å·¥å…·æ¥å£å®šä¹‰ã€‚æè¿° query, trend, rollup ç­‰åŸå­åˆ†æèƒ½åŠ›ã€‚
â”‚   â””â”€â”€ business_definition.json # ä¸šåŠ¡å®ä½“å®šä¹‰ã€‚åŒ…å«è½¦å‹æ˜ å°„ã€æ—¶é—´å‘¨æœŸ (CM0/DM0)ã€äº§å“åˆ†ç±»é€»è¾‘ã€‚
â””â”€â”€ .env                         # ç¯å¢ƒé…ç½® (API Key)ã€‚
```

## 3. æ ¸å¿ƒå·¥ä½œæµ (Workflow)

è¯¥ç³»ç»Ÿé‡‡ç”¨ **æ£€ç´¢å¢å¼ºç”Ÿæˆ (RAG)** + **ç­–ç•¥æ¨¡æ¿å¡«å……** çš„æ··åˆæ¨¡å¼ã€‚Agent åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½æ‰€æœ‰é¢†åŸŸçŸ¥è¯†ï¼Œæ ¹æ®ç”¨æˆ·æ„å›¾åŒ¹é…é¢„å®šä¹‰çš„åˆ†æç­–ç•¥ã€‚

```mermaid
graph TD
    User["ç”¨æˆ· (User)"] -->|"è‡ªç„¶è¯­è¨€æŸ¥è¯¢"| Agent[PlanningAgent]

    subgraph Context_Loading ["ä¸Šä¸‹æ–‡åŠ è½½"]
        Schema[schema.md] -.-> Agent
        Tools[tool.md] -.-> Agent
        BizDef[business_definition.json] -.-> Agent
        Rules[planning_rules.yaml] -.-> Agent
    end

    subgraph Reasoning_Process ["æ¨ç†è¿‡ç¨‹"]
        Agent -->|"1. æ„å›¾è¯†åˆ«"| Intent{"åŒ¹é…æ„å›¾"}
        Intent -->|"Status Check"| Strat1["ç­–ç•¥: Breadth Scan"]
        Intent -->|"Trend Analysis"| Strat2["ç­–ç•¥: Trend Scan"]

        Strat1 -->|"2. ç­–ç•¥åŠ è½½"| Steps["åŠ è½½ DSL æ¨¡æ¿æ­¥éª¤"]

        Steps -->|"3. å®ä½“æ˜ å°„"| Fill["å¡«å……å‚æ•°"]
        Fill -->|"è§£æ {{target_date}}"| Date["æ—¶é—´æ¨æ–­"]
        Fill -->|"è§£æ {{primary_metric}}"| Metric["æŒ‡æ ‡æ˜ å°„"]
        Fill -->|"è§£æ Filter"| Filter["ä¸šåŠ¡è§„åˆ™è¿‡æ»¤"]
    end

    Fill -->|"4. ç”Ÿæˆè®¡åˆ’"| DSL["åˆ†æåŠ¨ä½œçŸ©é˜µ (JSON DSL)"]
```

## 4. æ•°æ®æµ (Data Flow)

æ•°æ®æµæè¿°äº†ä¿¡æ¯å¦‚ä½•åœ¨ç³»ç»Ÿå„ç»„ä»¶é—´æµè½¬ï¼Œæœ€ç»ˆè½¬åŒ–ä¸ºå¯æ‰§è¡Œçš„æŒ‡ä»¤ã€‚

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ· (User)
    participant PA as PlanningAgent
    participant KB as é¢†åŸŸçŸ¥è¯†åº“ (World)
    participant LLM as Deepseek API

    U->>PA: "CM2 å¢ç¨‹é”€é‡å¦‚ä½•ï¼Ÿ"

    note over PA: åˆå§‹åŒ– & ä¸Šä¸‹æ–‡åŠ è½½
    PA->>KB: è¯»å– Schema, Tools, Rules, BizDef
    KB-->>PA: è¿”å›ä¸Šä¸‹æ–‡å†…å®¹

    note over PA: æ„å»º System Prompt
    PA->>PA: æ³¨å…¥ product_type_logic (å¢ç¨‹å®šä¹‰)
    PA->>PA: æ³¨å…¥ model_series_mapping (CM2 å®šä¹‰)
    PA->>PA: æ³¨å…¥ planning_rules (åˆ†æç­–ç•¥)

    PA->>LLM: å‘é€ Prompt + ç”¨æˆ· Query

    note over LLM: æ€è€ƒä¸ç”Ÿæˆ
    LLM->>LLM: è¯†åˆ«æ„å›¾ -> Status Check
    LLM->>LLM: åº”ç”¨ç­–ç•¥ -> Breadth Scan
    LLM->>LLM: æ‰©å±•æ­¥éª¤ -> Baseline -> Trend -> Anomaly -> Rollup
    LLM->>LLM: ç”Ÿæˆ JSON DSL

    LLM-->>PA: è¿”å› JSON å“åº”

    PA->>U: è¾“å‡ºç»“æ„åŒ– DSL
```

## 5. å…³é”®æŠ€æœ¯äº®ç‚¹

æœ¬é¡¹ç›®åœ¨è®¾è®¡ä¸Šä½“ç°äº†ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒäº®ç‚¹ï¼Œä½¿å…¶åŒºåˆ«äºæ™®é€šçš„ Text-to-SQL å·¥å…·ï¼š

1.  **<u>é…ç½®é©±åŠ¨çš„ç­–ç•¥å¼•æ“ (Configuration-Driven Strategy)</u>**

    - å°†åˆ†ææµç¨‹æŠ½è±¡ä¸º `planning_rules.yaml` ä¸­çš„æ¨¡æ¿ã€‚**ä¿®æ”¹ YAML å³å¯è°ƒæ•´åˆ†ææ·±åº¦å’Œæ­¥éª¤ï¼ˆå¦‚æ–°å¢â€œå¼‚å¸¸æ£€æµ‹â€ï¼‰ï¼Œæ— éœ€ä¿®æ”¹ä¸€è¡Œ Python ä»£ç **ã€‚è¿™ä½¿å¾—ä¸šåŠ¡åˆ†æå¸ˆå¯ä»¥ç›´æ¥ç»´æŠ¤åˆ†æé€»è¾‘ã€‚

2.  **<u>ç»“æ„åŒ– DSL çŸ©é˜µ (Structured DSL Matrix)</u>**

    - è¾“å‡ºä¸æ˜¯ä¸ç¨³å®šçš„è‡ªç„¶è¯­è¨€ï¼Œä¹Ÿä¸æ˜¯å¤æ‚çš„ SQLï¼Œè€Œæ˜¯ **æ ‡å‡†åŒ–ã€äººæœºå¯è¯»çš„ JSON åŠ¨ä½œåºåˆ—**ã€‚æ¯ä¸ªæ­¥éª¤åŒ…å« `tool_name`, `parameters`, `reasoning` å’Œ `output_key`ï¼Œå®Œç¾æ”¯æŒ **<u>ä¸‹æ¸¸æ¨ç†çŠ¶æ€æœº (Reasoning State Machine)</u>** çš„ç¼“å­˜ä¸å›æ”¾ã€‚

3.  **<u>ä¸šåŠ¡è¯­ä¹‰å±‚æ³¨å…¥ (Semantic Layer Injection)</u>**

    - é€šè¿‡ `business_definition.json` æ˜¾å¼å®šä¹‰â€œé»‘è¯â€å’Œå¤æ‚é€»è¾‘ï¼ˆå¦‚â€œå¢ç¨‹â€=`Name LIKE %52%`ï¼Œâ€œCM2â€=`ç‰¹å®šæ—¥æœŸèŒƒå›´`ï¼‰ã€‚Agent èƒ½å¤Ÿ **<u>é›¶æ ·æœ¬ (Zero-shot)</u>** ç†è§£ä¼ä¸šç‰¹æœ‰çš„ä¸šåŠ¡æœ¯è¯­ï¼Œæ— éœ€å¾®è°ƒæ¨¡å‹ã€‚

4.  **<u>ç¡®å®šæ€§æ€ç»´é“¾ (Deterministic Chain-of-Thought)</u>**

    - é€šè¿‡å¼ºåˆ¶ LLM éµå¾ªâ€œåŸºçº¿ -> è¶‹åŠ¿ -> å¼‚å¸¸ -> ç»“æ„â€çš„ **<u>å¹¿åº¦æ‰«æ (Breadth Scan)</u>** ç­–ç•¥ï¼Œé¿å…äº†æ¨¡å‹â€œæƒ³åˆ°å“ªå†™åˆ°å“ªâ€çš„å¹»è§‰é—®é¢˜ï¼Œç¡®ä¿äº†åˆ†æç»“æœçš„ **å®Œæ•´æ€§** å’Œ **ä¸“ä¸šæ€§**ã€‚

5.  **<u>æ„å›¾å¯¼å‘çš„åŠ¨æ€è§„åˆ’ (Intent-Based Dynamic Planning)</u>**
    - ç³»ç»Ÿé¦–å…ˆå¯¹ç”¨æˆ·é—®é¢˜è¿›è¡Œ **æ„å›¾åˆ†ç±»**ï¼ˆå¦‚çŠ¶æ€è¯„ä¼° vs å½’å› åˆ†æï¼‰ï¼Œç„¶ååŠ¨æ€æŒ‚è½½ä¸åŒçš„åˆ†æç­–ç•¥ã€‚è¿™ä½¿å¾—åŒä¸€ä¸ª Agent å¯ä»¥çµæ´»åº”å¯¹ **â€œæ˜¯å¤šå°‘â€ (Fact Lookup)** å’Œ **â€œä¸ºä»€ä¹ˆâ€ (Attribution)** ç­‰ä¸åŒæ·±åº¦çš„æŸ¥è¯¢ã€‚

## 6. æ‰§è¡Œå¼•æ“æ¶æ„ (Execution Engine)

åœ¨ç”Ÿæˆ DSL ä¹‹åï¼Œç³»ç»Ÿå¼•å…¥äº† **LangGraph** ä½œä¸ºæ ¸å¿ƒæ‰§è¡Œå¼•æ“ï¼Œæ„å»ºäº†ä¸€ä¸ªæ¨¡å—åŒ–ã€å¯è§‚æµ‹çš„ **Tool Execution Pipeline**ã€‚

### æ¶æ„è®¾è®¡

```text
pipelines/bi_copilot.py  -->  Application Entry (DSL -> Graph -> Result)
agents/execution_graph.py -->  StateGraph Definition (Loop: Step -> Router -> Tool)
tools/router.py          -->  Tool Dispatcher
tools/*.py               -->  Atomic Tool Implementations
```

### æ ¸å¿ƒç»„ä»¶

1.  **Execution State (`execution_state.py`)**: ç»´æŠ¤æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸Šä¸‹æ–‡çŠ¶æ€ï¼ŒåŒ…æ‹¬ï¼š

    - `dsl_sequence`: å¾…æ‰§è¡Œçš„åŠ¨ä½œåºåˆ—ã€‚
    - `current_step`: å½“å‰æ‰§è¡ŒæŒ‡é’ˆã€‚
    - `results`: å­˜å‚¨æ¯ä¸€æ­¥å·¥å…·çš„æ‰§è¡Œç»“æœï¼ˆæ”¯æŒåç»­æ­¥éª¤å¼•ç”¨ï¼‰ã€‚
    - `signals`: è¿è¡Œæ—¶äº§ç”Ÿçš„ä¿¡å·ï¼ˆå¦‚å¼‚å¸¸æ£€æµ‹è§¦å‘çš„ drill-down ä¿¡å·ï¼‰ã€‚

2.  **Tool Router (`router.py`)**: è´Ÿè´£å°†æŠ½è±¡çš„ DSL Step åˆ†å‘ç»™å…·ä½“çš„ Tool å®ç°ç±»ã€‚

    - æ”¯æŒæ‰©å±•æ–°çš„å·¥å…·åªéœ€æ³¨å†Œåˆ° Routerï¼Œæ— éœ€ä¿®æ”¹ Graph é€»è¾‘ã€‚

3.  **LangGraph Workflow**:
    - é‡‡ç”¨å¾ªç¯å›¾ç»“æ„ï¼š`execute_step` -> `should_continue` -> `execute_step` / `END`ã€‚
    - è¿™ç§è®¾è®¡æœªæ¥å¯è½»æ¾æ‰©å±•ä¸ºæ”¯æŒ **ReAct** æ¨¡å¼ï¼ˆå³å…è®¸ Agent åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ ¹æ®ç»“æœåŠ¨æ€ä¿®æ”¹åç»­è®¡åˆ’ï¼‰ã€‚

### å®Œæ•´æ•°æ®æµ (End-to-End Flow)

```mermaid
graph LR
    NL[ç”¨æˆ·é—®é¢˜] --> Planning[PlanningAgent]
    Planning --> DSL[DSL Matrix]

    DSL --> Graph[Execution Graph]

    subgraph Execution_Loop [LangGraph Loop]
        Graph --> Step[Fetch Step i]
        Step --> Router[Tool Router]
        Router --> Query[QueryTool]
        Router --> Trend[TrendTool]
        Router --> Rollup[RollupTool]

        Query & Trend & Rollup --> Result[Update State]
        Result --> Next{Has Next?}
        Next -- Yes --> Step
    end

    Next -- No --> Final[Final Result]
```

---

## 7. ğŸ“… ä»Šæ—¥æˆæœæ€»ç»“ (2026-01-04) è¿è¡Œæ—¶ä¸æ•°æ®æ¥å…¥ (Runtime & Data Access)

ä¸ºäº†æ”¯æŒçœŸå®çš„ä¸šåŠ¡æ•°æ®åˆ†æï¼Œç³»ç»Ÿå®ç°äº†ç¨³å¥çš„è¿è¡Œæ—¶ç¯å¢ƒï¼š

1.  **å•ä¾‹æ•°æ®ç®¡ç†å™¨ (Singleton DataManager)**

    - ä½äº `runtime/context.py`ï¼Œç¡®ä¿å¤§è§„æ¨¡ Parquet æ•°æ® (`order_full_data.parquet`) ä»…åŠ è½½ä¸€æ¬¡ã€‚
    - **T+1 æ—¶é—´é€»è¾‘**: è‡ªåŠ¨åŸºäºç³»ç»Ÿæ—¶é—´æ¨æ–­ "Yesterday"ï¼Œå¹¶ç»“åˆæ•°æ®æœ€å¤§æ—¥æœŸè¿›è¡Œè¾¹ç•Œæ ¡éªŒã€‚
    - **åŠ¨æ€ä¸šåŠ¡é€»è¾‘æ³¨å…¥**: åœ¨åŠ è½½æ—¶å®æ—¶è®¡ç®— `series_group` ç­‰è¡ç”Ÿç»´åº¦ã€‚

2.  **å¢å¼ºå‹è¶‹åŠ¿åˆ†æ (Enhanced Trend Analysis)**

    - `TrendTool` å®ç°äº†æ™ºèƒ½å›æº¯æŸ¥è¯¢ã€‚é’ˆå¯¹å•ç‚¹æ—¶é—´ï¼ˆå¦‚â€œæ˜¨æ—¥â€ï¼‰çš„æŸ¥è¯¢ï¼Œè‡ªåŠ¨æ£€ç´¢ T-1 å’Œ T-7 æ•°æ®ä»¥è®¡ç®—æ—¥ç¯æ¯” (DoD) å’Œå‘¨åŒæ¯” (WoW)ï¼Œè§£å†³äº†å•ç‚¹æ•°æ®æ— æ³•è®¡ç®—å˜åŒ–ç‡çš„é—®é¢˜ã€‚

3.  **ç»Ÿè®¡å¼‚å¸¸æ£€æµ‹ (Statistical Anomaly Detection)**
    - åŸºäºå†å²æ»‘åŠ¨çª—å£ï¼ˆå¦‚æœ€è¿‘ 30 å¤©ï¼‰è®¡ç®—å‡å€¼ä¸æ ‡å‡†å·®ã€‚
    - ä½¿ç”¨ Z-Score å’Œå˜å¼‚ç³»æ•° (CV) åˆ¤å®šæ•°æ®æ³¢åŠ¨æ˜¯å¦å±äºæ­£å¸¸èŒƒå›´ï¼Œè‡ªåŠ¨ç”Ÿæˆ `anomaly_decision` ä¿¡å·ã€‚

---

è¿™ä»½æ–‡æ¡£æ€»ç»“äº†å½“å‰ W52 Copilot çš„æŠ€æœ¯æ¶æ„ä¸æ ¸å¿ƒä»·å€¼ï¼Œå¯ä½œä¸ºåç»­å¼€å‘è¿­ä»£çš„åŸºçŸ³ã€‚

---

## 8. æ¡ˆä¾‹åˆ†æï¼šæ˜¨æ—¥é”å•é‡åˆ†ææµ (Case Study: Yesterday Lock Analysis)

æœ¬æ¡ˆä¾‹å±•ç¤ºäº†ç³»ç»Ÿå¦‚ä½•å¤„ç†â€œæ˜¨æ—¥é”€é‡å¦‚ä½•â€è¿™ä¸€å…¸å‹ä¸šåŠ¡é—®é¢˜ã€‚
è„šæœ¬è·¯å¾„: `pipelines/yesterday_lock.py`

### åˆ†æé€»è¾‘æµ (Reasoning Flow)

è¯¥æµç¨‹ä½“ç°äº† **Breadth Scan (å¹¿åº¦æ‰«æ)** ç­–ç•¥ï¼šå…ˆçœ‹æ€»æ•°ï¼Œå†çœ‹è¶‹åŠ¿ï¼Œæœ€åçœ‹ç»“æ„ã€‚

```mermaid
graph TD
    %% Nodes
    Start([Start: DSL Sequence])

    subgraph Status_Check [1. çŠ¶æ€è¯„ä¼°]
        S1["Baseline Query<br/>(Tool: Query)"]
    end

    subgraph Trend_Analysis [2. è¶‹åŠ¿ä¸å¼‚åŠ¨]
        S2["Short-term Trend<br/>(MoM / DoD)"]
        S3["Cycle Comparison<br/>(WoW)"]
        S4["Anomaly Check<br/>(vs 30-day Avg)"]
    end

    subgraph Structure_Analysis [3. ç»“æ„æ´å¯Ÿ]
        S5["Structural Rollup<br/>(by Series Group)"]
        S6["Composition Share<br/>(Contribution %)"]
        S7["Pareto Scan<br/>(80/20 Rule)"]
    end

    End([End: Final Report])

    %% Edges
    Start --> S1
    S1 --> S2
    S2 --> S3
    S3 --> S4
    S4 --> S5
    S5 --> S6
    S6 --> S7
    S7 --> End

    %% Styling
    style S1 fill:#e3f2fd,stroke:#1565c0
    style S2 fill:#fff3e0,stroke:#e65100
    style S3 fill:#fff3e0,stroke:#e65100
    style S4 fill:#ffebee,stroke:#c62828
    style S5 fill:#e8f5e9,stroke:#2e7d32
    style S6 fill:#e8f5e9,stroke:#2e7d32
    style S7 fill:#e8f5e9,stroke:#2e7d32
```

### å…³é”®æ­¥éª¤è§£æä¸è¿è¡Œç»“æœ

1.  **Baseline Query (åŸºçº¿æŸ¥è¯¢)**

    - **åŠ¨ä½œ**: `QueryTool` è·å–æ˜¨æ—¥ (`2026-01-05`) çš„ç»å¯¹å€¼ã€‚
    - **ç»“æœ**: é”å•é‡ä¸º **67** å•ã€‚

2.  **Trend Analysis (è¶‹åŠ¿åˆ†æ)**

    - **MoM (æ—¥ç¯æ¯”)**: ç›¸æ¯”å‰ä¸€æ—¥ä¸‹é™ **6.0** å• (-8.2%)ï¼ŒçŸ­æœŸç•¥æœ‰å›è½ã€‚
    - **WoW (å‘¨åŒæ¯”)**: ç›¸æ¯”ä¸Šå‘¨åŒæœŸä¸‹é™ **225.0** å• (-77.1%)ï¼Œæ˜¾ç¤ºå‡ºæ˜¾è‘—çš„å‘¨æœŸæ€§ä¸‹æ»‘ã€‚
    - **Anomaly (å¼‚å¸¸æ£€æµ‹)**:
      - è¿‡å» 30 å¤©å‡å€¼ä¸º 275.2ï¼Œæ ‡å‡†å·® 173.1ã€‚
      - æ˜¨æ—¥å€¼ (67) å¯¹åº”çš„ **Z-Score ä¸º -1.2**ï¼Œå±äºâ€œ**æ­£å¸¸æ³¢åŠ¨**â€èŒƒå›´å†… (æœªè¶…è¿‡ Â±3Ïƒ é˜ˆå€¼)ï¼Œå› æ­¤æœªè§¦å‘è¿›ä¸€æ­¥çš„å¼‚å¸¸å½’å› ä¿¡å·ã€‚

3.  **Structure Analysis (ç»“æ„æ´å¯Ÿ)**
    - **Rollup & Composition**: æŒ‰è½¦ç³» (`series_group`) æ‹†è§£ã€‚
      - **CM2**: 35 å• (å æ¯” **52.2%**) â€”â€” _æ ¸å¿ƒä¸»åŠ›_
      - **LS9**: 25 å• (å æ¯” 37.3%)
      - **DM1**: 7 å• (å æ¯” 10.4%)
    - **Pareto Scan**: è¯†åˆ«å‡ºå‰ä¸¤æ¬¾è½¦å‹ (CM2 + LS9) è´¡çŒ®äº†è¿‘ **90%** çš„é”€é‡ï¼Œç¬¦åˆäºŒå…«å®šå¾‹ã€‚

> é€šè¿‡è¿™ä¸€å¥—è‡ªåŠ¨åŒ–çš„â€œå¹¿åº¦æ‰«æâ€ï¼Œåˆ†æå¸ˆæ— éœ€æ‰‹åŠ¨è·‘æ•°ï¼Œå³å¯åœ¨å‡ ç§’é’Ÿå†…è·å¾—åŒ…å«**ç°çŠ¶ã€è¶‹åŠ¿ã€å¼‚åŠ¨åˆ¤æ–­åŠç»“æ„å½’å› **çš„å®Œæ•´ç®€æŠ¥ã€‚

---

## 9. å…³é”®èŠ‚ç‚¹è®°å½• (2026-01-12) - æ—¶é—´åŒºé—´è½¨è¿¹åˆ†æ (Trajectory Mode)

ä¸ºæ”¯æŒæ›´é•¿å‘¨æœŸçš„é£é™©ç›‘æµ‹ï¼Œç³»ç»Ÿå®Œæˆäº†ä»â€œå•ç‚¹è¯Šæ–­â€åˆ°â€œåŒºé—´è½¨è¿¹åˆ†æâ€çš„èƒ½åŠ›å‡çº§ã€‚

### æ ¸å¿ƒæ”¹åŠ¨

1.  **å‚æ•°è¯­ä¹‰å‡çº§**: `pipelines/yesterday_lock.py` ä¸ `pipelines/yesterday_rate.py` ç°å‡æ”¯æŒ `--start` å’Œ `--end` å…¥å‚ï¼Œå…è®¸ç”¨æˆ·æŒ‡å®šä»»æ„è§‚å¯Ÿçª—å£ã€‚
2.  **è½¨è¿¹æ¨¡å¼ (Trajectory Mode)**:
    - æ‘’å¼ƒäº†ç²—ç³™çš„â€œåŒºé—´å‡å€¼â€åˆ†ææ³•ï¼Œé‡‡ç”¨ **é€æ—¥æ‰«æ (Day-by-Day Scan)** ç­–ç•¥ã€‚
    - ç³»ç»Ÿå¯¹åŒºé—´å†…æ¯ä¸€å¤©æ‰§è¡Œå®Œæ•´çš„ DSL åˆ†æåºåˆ—ï¼Œç”Ÿæˆç‹¬ç«‹çš„é£é™©ä¿¡å·ã€‚
3.  **ç»Ÿä¸€é€»è¾‘å†…æ ¸**:
    - é‡æ„ä»£ç å®ç°äº† `analyze_point` (åŸå­èƒ½åŠ›) ä¸ `analyze_range` (ç¼–æ’èƒ½åŠ›) çš„åˆ†ç¦»ã€‚
    - ç¡®ä¿äº†å•æ—¥è¯Šæ–­ä¸åŒºé—´æ‰«æä½¿ç”¨**å®Œå…¨åŒä¸€å¥—**å¼‚å¸¸æ£€æµ‹æ ‡å‡†ï¼Œé¿å…äº†è§„åˆ™åˆ†è£‚ã€‚

### è¿è¡Œç¤ºä¾‹

```bash
# é”å•é‡ç›‘æµ‹ï¼ˆåŒºé—´æ¨¡å¼ï¼‰
python -m pipelines.yesterday_lock --start 2026-01-01 --end 2026-01-05

# è½¬åŒ–ç‡ç›‘æµ‹ï¼ˆåŒºé—´æ¨¡å¼ï¼‰
python -m pipelines.yesterday_rate --start 2026-01-01 --end 2026-01-05
```

### è¾“å‡ºæ•ˆæœ

é™¤äº†æ¯æ—¥çš„è¯¦ç»†è¯Šæ–­å¤–ï¼Œç³»ç»Ÿä¼šåœ¨æœ€åç”Ÿæˆ **åŒºé—´è½¨è¿¹æ±‡æ€»**ï¼š

```text
==================================================
ğŸ“… åŒºé—´è½¨è¿¹æ±‡æ€» (2026-01-01 ~ 2026-01-05)
==================================================
å…±åˆ†æ 5 å¤©
ğŸ”´ é«˜é£é™©å¤©æ•°: 1
ğŸŸ¡ ä¸­é£é™©å¤©æ•°: 1
âš ï¸ é«˜é£é™©æ—¥æœŸè¯¦æƒ…:
  - 2026-01-01: è¶‹åŠ¿å¼‚å¸¸: sales (é«˜æ³¢åŠ¨å¼‚å¸¸), åˆ†å¸ƒåç§»...
```

---

## 10. å…³é”®èŠ‚ç‚¹è®°å½• (2026-01-12) - DeepSeek Thinking Mode å¼•å…¥

ä¸ºè§£å†³å¤æ‚å½’å› åˆ†æä¸­çš„é€»è¾‘æ¨ç†é—®é¢˜ï¼Œç³»ç»Ÿåœ¨æ¯æ—¥ç»è¥åˆ†æç®¡é“ä¸­å¼•å…¥äº† **DeepSeek Thinking Mode (æ·±åº¦æ€è€ƒæ¨¡å¼)**ã€‚

ç›¸å…³æ–‡ä»¶ï¼š

- Pipeline: [`pipelines/yesterday_lock_reasoner.py`](pipelines/yesterday_lock_reasoner.py)
- Configuration: [`agents/query_skills.yaml`](agents/query_skills.yaml) - **New**: é›†ä¸­ç®¡ç†æŸ¥è¯¢æŠ€èƒ½ä¸è§„åˆ™ã€‚

### 10.1 æ¯æ—¥ç»è¥åˆ†æå‡çº§ (Pipeline Upgrade)

æˆ‘ä»¬å°† [`pipelines/yesterday_lock.py`](pipelines/yesterday_lock.py) å‡çº§ä¸º [`pipelines/yesterday_lock_reasoner.py`](pipelines/yesterday_lock_reasoner.py)ï¼Œåˆ©ç”¨ DeepSeek Reasoner çš„æ¨ç†èƒ½åŠ›ï¼Œå°†å†°å†·çš„ JSON æ•°æ®è½¬åŒ–ä¸ºé«˜å¯†åº¦çš„ä¸šåŠ¡ç®€æŠ¥ã€‚

**å¯¹æ¯”æ¡ˆä¾‹ï¼š2026-01-11 ç»è¥åˆ†æ**

| ç»´åº¦         | åŸç‰ˆ (`yesterday_lock.py`)             | Reasoner ç‰ˆ (`yesterday_lock_reasoner.py`)        |
| :----------- | :------------------------------------- | :------------------------------------------------ |
| **è¾“å‡ºå½¢å¼** | åŸå§‹ JSON + ç®€å•çš„è§„åˆ™åˆ¤å®š (ğŸŸ¢ ä½é£é™©) | **ç»“æ„åŒ–ä¸šåŠ¡ç®€æŠ¥** (è¯Šæ–­/å½’å› /é£é™©)               |
| **ä¿¡æ¯å¯†åº¦** | ä½ï¼Œéœ€è¦äººå·¥è§£è¯» JSON ä¸­çš„å…·ä½“æ•°å€¼     | **é«˜**ï¼Œç›´æ¥æŒ‡å‡ºâ€œCR2 é«˜è¾¾ 92.1%â€ã€â€œZ-Score -0.20â€ |
| **å½’å› åˆ†æ** | æ— ï¼Œä»…å±•ç¤ºæ•°æ®                         | **è‡ªåŠ¨å…³è”**ï¼Œå°†ç»“æ„æ•°æ®ä¸å¼‚å¸¸ä¿¡å·ç»“åˆè§£é‡Š        |

**è¿è¡Œæ•ˆæœå¯¹æ¯”ï¼š**

**1. åŸç‰ˆ (`yesterday_lock.py`)** - _JSON å †ç Œï¼Œä»…æœ‰åŸºç¡€çš„é£é™©è¯„çº§_

```text
Final results:
{'baseline_query': {'value': 229, ...}, 'signals': [...]}

Signals:
[{'type': 'anomaly_decision', 'flag': 'æ­£å¸¸æ³¢åŠ¨', ...}]

ğŸŸ¢ [2026-01-11] ç»¼åˆè¯„ä¼°ï¼šé£é™©ç­‰çº§ï¼šä½
```

**2. Reasoner ç‰ˆ (`yesterday_lock_reasoner.py`)** - _é«˜å¯†åº¦ã€å»å™ªçš„ä¸šåŠ¡è¯Šæ–­_

```text
==================================================
ğŸ“Š DeepSeek Reasoner Analysis Report (2026-01-11)
==================================================
## ğŸŸ¢ è¯Šæ–­ç»“è®ºï¼šé£é™© Low
**æ ¸å¿ƒæ•°æ®**ï¼šé”€é‡ 229 (ç¯æ¯”+6.5%, åŒæ¯”+213.7%)ã€‚
**é£é™©åˆ¤å®š**ï¼šå„é¡¹æŒ‡æ ‡è¿è¡Œå¹³ç¨³ã€‚

## ğŸ” å¼‚åŠ¨å½’å› 
**1. ç»“æ„æ‹†è§£**ï¼šCM2 å æ¯” 73.8%ï¼Œè´¡çŒ®äº†ç»å¤§éƒ¨åˆ†é”€å”®é¢ï¼Œä¸”å…¶ç¯æ¯”å¢é€Ÿå¿«äºæ•´ä½“ã€‚
**2. åˆ†å¸ƒç‰¹å¾**ï¼šè®¢å•æµè½¬å¤©æ•°åˆ†å¸ƒé›†ä¸­ï¼Œçº¦73.8%çš„è®¢å•åœ¨5å¤©å†…å®Œæˆï¼Œä¸å†å²åˆ†å¸ƒåŸºæœ¬ä¸€è‡´ã€‚
```

### 10.2 äº¤äº’å¼æŸ¥è¯¢ (Interactive Query)

é€šè¿‡ `pipelines/simple_query.py`ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥ä¸æ•°æ®è¿›è¡Œäº¤äº’ï¼Œæ”¯æŒå¤šç»´èšåˆä¸æ—¶é—´åºåˆ—æŸ¥è¯¢ã€‚

#### åœºæ™¯ 1: å¤æ‚èšåˆä¸å¯¹æ¯”

**Case: "LS6 å’Œ LS9 æ˜¨å¤©çš„é”å•å¯¹æ¯”"**

**1. åŸç‰ˆ (`simple_query.py`)** - _æ”¯æŒäº¤äº’å¼æŸ¥è¯¢ä¸å¤šç»´èšåˆ_

```text
User> LS6 å’Œ LS9 æ˜¨å¤©çš„é”å•å¯¹æ¯”
ğŸš€ Processing: 'LS6 å’Œ LS9 æ˜¨å¤©çš„é”å•å¯¹æ¯”'
--- Final Result ---
ï¿½ Breakdown: é”å•é‡ by series | Count: 2
| series   |   value |
|:---------|--------:|
| LS6      |     172 |
| LS9      |      42 |
--------------------
```

#### åœºæ™¯ 2: è¶‹åŠ¿ä¸æ¨¡ç³ŠåŒ¹é… (New Skills)

**Case: "LS6 å¢ç¨‹ 2025 å¹´æ¯ä¸ªæœˆçš„å¼€ç¥¨æ•°" (Time Series)**

```text
User> LS6 å¢ç¨‹ 2025å¹´æ¯ä¸ªæœˆçš„å¼€ç¥¨æ•°
ğŸš€ Processing: 'LS6 å¢ç¨‹ 2025å¹´æ¯ä¸ªæœˆçš„å¼€ç¥¨æ•°'
--- Final Result ---
ğŸ“ˆ Time Series (month): å¼€ç¥¨é‡
  2025-01: 153
  2025-02: 189
  ...
--------------------
```

**Case: "ä¸Šæµ·çš„å¼€ç¥¨æ•°" (Fuzzy Match: 'ä¸Šæµ·' -> 'store_city' contains 'ä¸Šæµ·')**

```text
User> ä¸Šæµ·çš„å¼€ç¥¨æ•°
ğŸš€ Processing: 'ä¸Šæµ·çš„å¼€ç¥¨æ•°'
--- Final Result ---
ğŸ”¢ å¼€ç¥¨é‡: 977
--------------------
```

## 11. ğŸš€ å…³é”®èŠ‚ç‚¹è®°å½• (2026-01-13) - yesterday_rate_reasoner

ä¸ºé™ä½ Token æ¶ˆè€—å¹¶æå‡å½’å› ç²¾å‡†åº¦ï¼Œæˆ‘ä»¬åœ¨ [`pipelines/yesterday_rate_reasoner.py`](pipelines/yesterday_rate_reasoner.py) ä¸­å¼•å…¥äº† **â€œæ¡ä»¶è§¦å‘å¼â€ (Conditional Trigger)** è¯Šæ–­æµç¨‹ã€‚ç³»ç»Ÿä»…åœ¨æ£€æµ‹åˆ°æ˜¾è‘—å¼‚å¸¸æ—¶ï¼Œæ‰åŠ¨æ€åŠ è½½æ·±å±‚åˆ†æä»»åŠ¡ï¼ˆå¦‚ WoW å‘¨æœŸæ€§å¯¹æ¯”ï¼‰ï¼Œå®ç°ç²¾ç»†åŒ–çš„ Token é¢„ç®—ç®¡ç†ã€‚

### æ ¸å¿ƒæµç¨‹å›¾ (Workflow)

```mermaid
graph TD
    Start([Start Pipeline]) --> Baseline["Baseline Analysis<br/>(MoM / 7d Rates)"]
    Baseline --> RiskCheck{"Structure Risk<br/>Assessment"}

    RiskCheck -->|Low/Mid Risk| Payload[Payload Assembly]
    RiskCheck -->|High Risk| Toolbox["High-Risk Toolbox<br/>(Distribution/Trend30d/LeadsMoM)"]

    Toolbox --> LeadsCheck{"Store Leads<br/>Fluctuation?"}
    LeadsCheck -->|Change < 10%| Payload
    LeadsCheck -->|Change >= 10%| WoW["WoW Analysis<br/>(Store Leads/Total Leads)"]

    WoW --> Payload

    Payload --> DeepSeek["DeepSeek Reasoner<br/>(Attribution Logic)"]
    DeepSeek --> Report([Final Report])

    style RiskCheck fill:#fff3e0,stroke:#f57c00
    style Toolbox fill:#ffebee,stroke:#d32f2f
    style WoW fill:#f3e5f5,stroke:#7b1fa2
    style DeepSeek fill:#e3f2fd,stroke:#1976d2
```

### æ ¸å¿ƒç‰¹æ€§

1.  **Lazy Loading (æŒ‰éœ€åŠ è½½)**:

    - åŸºç¡€å±‚ä»…è¿è¡Œæœ€ä½é™åº¦çš„ MoM å’Œ Rate æ£€æŸ¥ã€‚
    - **Level 1 Trigger**: ä»…å½“ç»“æ„é£é™©ï¼ˆStructure Riskï¼‰åˆ¤å®šä¸º `High` æ—¶ï¼Œæ‰åŠ è½½ `_toolbox_for_high_risk`ï¼ˆåŒ…å« 30 å¤©è¶‹åŠ¿ã€åˆ†å¸ƒå®šä½ï¼‰ã€‚
    - **Level 2 Trigger**: ä»…å½“ Level 1 å‘ç°é—¨åº—çº¿ç´¢æ˜¾è‘—æ³¢åŠ¨ï¼ˆ`change_pct >= 10%`ï¼‰æ—¶ï¼Œæ‰è¿½åŠ  `_get_wow_tasks` è¿›è¡Œå‘¨åŒæ¯”åˆ†æã€‚

2.  **Context Injection (ä¸Šä¸‹æ–‡æ³¨å…¥)**:

    - DeepSeek æ¥æ”¶çš„ Context éšç€æ’æŸ¥æ·±åº¦åŠ¨æ€ä¸°å¯Œã€‚
    - Prompt ä¼šè‡ªåŠ¨æ ¹æ®æ˜¯å¦æœ‰ WoW æ•°æ®ï¼Œå†³å®šæ˜¯å¦è¿›è¡Œâ€œå‘¨æœŸæ€§ vs éå‘¨æœŸæ€§â€çš„å½’å› åˆ¤æ–­ã€‚

3.  **Token Efficiency (æˆæœ¬ä¼˜åŒ–)**:
    - åœ¨æ— å¼‚å¸¸çš„å¹³ç¨³æœŸï¼Œç³»ç»Ÿè·³è¿‡æ‰€æœ‰æ·±å±‚å·¥å…·è°ƒç”¨ï¼ŒToken æ¶ˆè€—é™ä½ 60% ä»¥ä¸Šã€‚
    - ä»…åœ¨â€œåˆ€åˆƒä¸Šâ€èŠ±é’±ï¼Œç¡®ä¿é«˜é£é™©æ—¥æœŸçš„è¯Šæ–­æ·±åº¦ã€‚

### è¯¦ç»†æ‰§è¡Œé€»è¾‘ (Step-by-Step Logic)

1.  **Baseline Scan (åŸºå‡†æ‰«æ)**:

    - æ‰§è¡Œ 3 ä¸ªåŸºç¡€ DSL ä»»åŠ¡ï¼š`assign_leads_mom` (çº¿ç´¢æ€»é‡ç¯æ¯”), `assign_rate_7d_lock` (7 æ—¥é”å•ç‡), `assign_rate_7d_test_drive` (7 æ—¥è¯•é©¾ç‡)ã€‚
    - ç›®çš„ï¼šè·å–æœ€åŸºç¡€çš„â€œä½“æ¸©â€æŒ‡æ ‡ã€‚

2.  **Risk Assessment (é£é™©è¯„ä¼°)**:

    - è®¡ç®—ä»Šæ—¥çš„ **é—¨åº—çº¿ç´¢å æ¯”** (`store_share`) å’Œ **é—¨åº—å½“æ—¥é”å•ç‡** (`store_rate`)ã€‚
    - **Z-Score åˆ¤å®š**ï¼šåŸºäºå†å² 60 å¤©æ•°æ®è®¡ç®— Z åˆ†æ•°ã€‚è‹¥ä»»æ„æŒ‡æ ‡ `abs(Z) >= 2.0`ï¼Œåˆ¤å®šä¸º `High Risk`ï¼›è‹¥ `abs(Z) >= 1.2`ï¼Œåˆ¤å®šä¸º `Mid Risk`ã€‚
    - **Conditional Check**ï¼šå¯»æ‰¾å†å²ä¸Š `store_share` ç›¸ä¼¼ï¼ˆÂ±5% çª—å£ï¼‰çš„æ—¥æœŸï¼Œæ„å»ºâ€œå½“å‰çº¿ç´¢ç»“æ„ä¸‹çš„ç†è®ºè½¬åŒ–ç‡åŸºå‡†â€ï¼Œç”¨äºè¾…åŠ©åˆ¤æ–­æ˜¯å¦ä¸ºç»“æ„æ€§é—®é¢˜ã€‚

3.  **Level 1 Trigger: High Risk Toolbox (é«˜é£é™©å·¥å…·ç®±)**:

    - **è§¦å‘æ¡ä»¶**ï¼šRisk Level = `High`ã€‚
    - **æ‰§è¡Œä»»åŠ¡**ï¼š
      - **ç»“æ„åˆ†å¸ƒ**ï¼š`sales_dist_by_series` (è½¦å‹ç»“æ„ SAD åˆ†æ)ã€‚
      - **è¶‹åŠ¿å½¢æ€**ï¼š`sales_trend_30d` (30 å¤©é”€é‡è¶‹åŠ¿ï¼Œè¯†åˆ«é€€å¡/çˆ¬å¡)ã€‚
      - **æ°´ä½å®šä½**ï¼šå¯¹ 5 ä¸ªæ ¸å¿ƒæŒ‡æ ‡ï¼ˆé—¨åº—é”å•ç‡ã€é—¨åº—çº¿ç´¢å æ¯”ã€åº—å‡çº¿ç´¢å¼ºåº¦ã€7 æ—¥é”å•ç‡ã€7 æ—¥è¯•é©¾ç‡ï¼‰è¿›è¡Œè¿‘ 365 å¤©çš„åˆ†å¸ƒå®šä½ (Percentile)ï¼Œç¡®å®šå½“å‰æŒ‡æ ‡çš„å†å²æ°´ä½ã€‚
      - **çº¿ç´¢å¼‚åŠ¨**ï¼š`assign_trend_store_leads` (é—¨åº—çº¿ç´¢ç¯æ¯”)ã€‚

4.  **Level 2 Trigger: WoW Analysis (å‘¨åŒæ¯”åˆ†æ)**:

    - **è§¦å‘æ¡ä»¶**ï¼šLevel 1 å·²è§¦å‘ ä¸” é—¨åº—çº¿ç´¢ç¯æ¯”å˜åŒ– `abs(change_pct) >= 10%`ã€‚
    - **æ‰§è¡Œä»»åŠ¡**ï¼š
      - `assign_trend_store_leads_wow` (é—¨åº—çº¿ç´¢å‘¨åŒæ¯”)ã€‚
      - `assign_trend_leads_wow` (æ€»çº¿ç´¢å‘¨åŒæ¯”)ã€‚
    - **ç›®çš„**ï¼šåŒºåˆ†æ˜¯â€œå‘¨æœŸæ€§æ³¢åŠ¨â€ï¼ˆå¦‚å‘¨æœ«æ•ˆåº”ï¼‰è¿˜æ˜¯â€œéå‘¨æœŸæ€§å¼‚å¸¸â€ã€‚

5.  **DeepSeek Reasoner Synthesis (æ¨ç†æ€»ç»“)**:
    - å°†ä¸Šè¿°æ‰€æœ‰å±‚çº§çš„æ•°æ®æ‰“åŒ…ä¸º JSON Payload (`core`, `sales_orders`, `leads_trend`, `rate_trend`, `signals`)ã€‚
    - è°ƒç”¨ `deepseek-reasoner` æ¨¡å‹ï¼Œé…åˆâ€œé«˜å¯†åº¦è¯Šæ–­ä¸“å®¶â€ Promptã€‚
    - è¾“å‡ºåŒ…å« **é£é™©å®šæ€§**ã€**å¼‚å¸¸ Checklist** (ä»…å±•ç¤ºå¼‚å¸¸é¡¹) å’Œ **å½’å› é—­ç¯** çš„æç®€æŠ¥å‘Šã€‚
